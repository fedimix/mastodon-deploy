
- name: create config and data locations
  become: true
  file:
    path: "{{ item }}"
    state: directory
    owner: "{{ svc_user }}"
    group: "{{ svc_user }}"
  with_list:
    - "{{ data_root }}/storage/redis"
    - "{{ data_root }}/storage/postgres"
    - "{{ data_root }}/storage/mastodon"
    - "{{ data_root }}/storage/router"
    - "{{ data_root }}/router/public/default"
    - "{{ config_root }}/router"


- name: update all container images
  shell: >
    podman pull {{ artifact_repository }}/{{ base_image }}:{{ base_image_version }}

    podman tag {{ artifact_repository }}/{{ base_image }}:{{ base_image_version }} mastodon:latest

    podman pull {{ artifact_repository }}/{{ router_image }}:{{ router_image_version }}

    podman pull {{ redis_image }}:{{ redis_image_version }}

    podman pull {{ postgres_image }}:{{ postgres_image_version }}

